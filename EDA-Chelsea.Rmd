---
title: "EDA"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r data_join}
library(ezids)
movies <- read.csv('movies.csv', header=TRUE)
str(movies)
# our dataset has 85855 observations of  22 variables.

drop <- c('budget','usa_gross_income','worlwide_gross_income','metascore','reviews_from_users',
          'reviews_from_critics','production_company','description','writer')
movies <- movies[,!names(movies) %in% drop]
movies <- movies[!(movies$country == "") & !(movies$language == "") & !(movies$director == "") & !(movies$actors == ""),]
# we cleaned the data: drop 'budget','usa_gross_income','worlwide_gross_income','metascore','reviews_from_users',
#'reviews_from_critics','production_company','description','writer' because they are not related.we dropped “NA” #values from the dataset to simplify our analysis.


ratings <- read.csv('ratings.csv', header=TRUE)
drop <- c('allgenders_0age_avg_vote', 'allgenders_0age_votes', 'males_0age_avg_vote', 'males_0age_votes',
          'females_0age_avg_vote', 'females_0age_votes', 'us_voters_rating', 'us_voters_votes', 
          'non_us_voters_rating', 'non_us_voters_votes')
ratings <- ratings[,!names(ratings) %in% drop]
ratings <- na.omit(ratings)
movie_ratings <- merge(movies, ratings, by="imdb_title_id" )

```


```{r Q1}
library(dplyr)
library(reshape)
movie_genre <- movie_ratings[,c("genre", "avg_vote")]
movie_genre <- movie_genre %>%
  mutate(
      Romance = grepl('Romance', genre),
      Biography = grepl('Biography', genre),
      Drama = grepl('Drama', genre),
      Adventure = grepl('Adventure', genre),
      History = grepl('History', genre),
      Crime = grepl('Crime', genre),
      Western = grepl('Western', genre),
      Fantasy = grepl('Fantasy', genre),
      Comedy = grepl('Comedy', genre),
      Horror = grepl('Horror', genre),
      Family = grepl('Family', genre),
      Action = grepl('Action', genre),
      Mystery = grepl('Mystery', genre),
      Sci_Fi = grepl('Sci-Fi', genre),
      Animation = grepl('Animation', genre),
      Thriller = grepl('Thriller', genre),
      Musical = grepl('Musical', genre),
      Music = grepl('Music', genre),
      War = grepl('War', genre),
      Film_Noir = grepl('Film-Noir', genre),
      Sport = grepl('Sport', genre),
      Adult = grepl('Adult', genre),
      Documentary = grepl('Documentary', genre),
      Reality_TV = grepl('Reality-TV', genre),
      News = grepl('News', genre)
  )
melt(movie_genre,id.vars = "genre", measure.vars = c("Romance",'Biography'), value.name = "avg_vote"
)
```


```{r Q2}

hist(movies$avg_vote)
library(ggplot2)
movie_director <- movie_ratings[,c("director", "avg_vote")]
movie_director

director_gourp <- aggregate(movie_director$avg_vote, by = list(director = movie_director$director),FUN=mean)
director_num <- movie_director %>% count(director,sort = TRUE)
director_vote <- merge(director_gourp,director_num,by='director')
director_vote <- director_vote[order(-director_vote$n),]
colnames(director_vote) <- c('director','rating','movie_numbers') 
director_vote

director_vote_40 <- subset(director_vote,movie_numbers>39)
director_vote_40$rating <- as.numeric(director_vote_40$rating)


ggplot(director_vote_40,aes(x=reorder(director,rating),y=rating))+
     geom_bar(stat='identity',fill='#f68060',alpha=.6, width=.4)+
     labs(title="Rating plot for directors(Moive numbers more than 40)")+
     coord_flip()+
     xlab('directors')+
     theme_bw()

```
```{r decription of the data}
# average vote distribution
str(movies)
summary(movies$avg_vote)
movies<-movies[!movies$year=='TV Movie 2019',]
hist(movies$avg_vote)
# A brief overview of the dataset: the minimum vote is 1.000,while the maximum vote is 9.900.
# the mean of the vote is 5.902, the median is 6.100.


# movies year-numbers distribution
years_numbers <- movies[,c('imdb_title_id', 'year')]
years_num <- years_numbers %>% count(year,sort = TRUE)
colnames(years_num)<-c('Year','Movie_numbers')
xkablesummary(years_numbers)

ggplot(years_num,aes(x=reorder(Year,Movie_numbers),y=Movie_numbers))+geom_col(stat='identity',fill='#f68060',alpha=.6, width=.4)+labs(title=('year and Movie_numbers'))+coord_flip()+ylab('Year')



# movies year-rating distribution
library(ggplot2)
years_rating <- aggregate(movies$avg_vote, by = list(director = movies$year),FUN=mean)
colnames(years_rating) <- c('Year','Rating')
xkablesummary(years_rating)

ggplot(data=years_rating,aes(x=reorder(Year,Rating),y=Rating)) +geom_col(stat='identify',width=0.9,fill='lightblue',binwidth=25)+coord_flip()+xlab('Year')+labs(title=('years and Rating'))



# movies vote distribution
years_vote <- aggregate(movies$votes, by = list(director = movies$year),FUN=sum)
colnames(years_vote) <- c('Year','Votes')
xkablesummary(years_vote)

ggplot(data=years_vote,aes(x=reorder(Year,Votes),y=Votes)) +geom_col(fill='purple4',alpha=1, width=2)+xlab('Year')+ylab('Votes')+coord_flip()+labs(title=('Year and votes'))

# movies duration-year distribution
years_duration <- aggregate(movies$duration, by = list(director = movies$year),FUN=mean)
colnames(years_duration) <- c('Year','Duration')
xkablesummary(years_duration)

ggplot(data=years_duration,aes(x=reorder(Year,Duration),y=Duration)) +geom_col(fill='purple4',alpha=1, width=2)+xlab('Year')+ylab('Duration')+coord_flip()+labs(title=('Year and Duration'))



# movies duration-rating distribution
summary(movies$duration)
duration <-outlierKD2(movies,movies$duration)
outliers <- boxplot(movies$duration,plot=FALSE)$out
movies1 <- movies[-which(movies$duration %in% outliers),]
duration_rating <- movies1[,c('duration','avg_vote')]
colnames(duration_rating)<-c("Duration","Rating")
xkablesummary(duration_rating)

ggplot(data=duration_rating,,mapping=aes(x=Duration,y=Rating)) +geom_col(fill='purple4',alpha=.6)+labs(title=('duration and rating'))

# correlation 
#cor.test(movies$avg_vote,as.numeric(movies$year))
#cor.test(movies$avg_vote,as.numeric(movies$duration))
#ggplot(movies,aes(x=duration,y=avg_vote))+ geom_point()

```